From 4fc27035455654c7da7e6fc727ece47811e5da1d Mon Sep 17 00:00:00 2001
From: Chris Feist <cfeist@redhat.com>
Date: Tue, 5 Aug 2014 15:27:29 -0500
Subject: [PATCH 01/10] If a cluster.conf file doesn't exist using --getversion
 should return an error, not '1'

---
 ricci/ccs/ccs | 11 +++++++++--
 1 file changed, 9 insertions(+), 2 deletions(-)

diff --git a/ricci/ccs/ccs b/ricci/ccs/ccs
index 5af89b0..8ea37a9 100755
--- a/ricci/ccs/ccs
+++ b/ricci/ccs/ccs
@@ -822,7 +822,7 @@ def remove_node(node_to_remove):
     set_cluster_conf(dom.toxml())
 
 def get_version():
-    dom = minidom.parseString(get_cluster_conf_xml())
+    dom = minidom.parseString(get_cluster_conf_xml(True))
     return dom.getElementsByTagName('cluster')[0].getAttribute("config_version")
 
 def set_version(version):
@@ -871,7 +871,7 @@ def get_cluster_schema_file():
         return None
     return out
 
-def get_cluster_conf_xml():
+def get_cluster_conf_xml(dont_return_empty = False):
     if usefile:
         try:
             f = open(filename, 'r')
@@ -889,6 +889,13 @@ def get_cluster_conf_xml():
         print "Cluster configuration file specified is not in a valid xml format."
         sys.exit(1)
 
+    if dont_return_empty and dom.getElementsByTagName('function_response').length > 0:
+        fr = dom.getElementsByTagName('function_response')[0]
+        for fr_var in fr.getElementsByTagName("var"):
+            if fr_var.getAttribute("name") == "success" and fr_var.getAttribute("value") == "false":
+                print "Unable to obtain cluster.conf file from remote node"
+                sys.exit(1)
+
     if dom.getElementsByTagName('cluster').length > 0:
         xml =  dom.getElementsByTagName('cluster')[0].toxml()
         if verifyconf and verify_cluster_conf(xml) != 0:
-- 
2.1.0

